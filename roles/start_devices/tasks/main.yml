---
 - name: run virtual router containers
   docker_container:
     name: "{{ inventory_hostname }}"
     image: "{{ docker_image }}"
     privileged: true
   register: container
   until: container.ansible_facts.docker_container.State.Health.Status == "healthy"
   retries: 10
   delay: 180

 - name: Template vrxcon p2p links 
   set_fact:
     xcon_links: "{% for device in xcon.links %}{{ device }}{% if not loop.last %} {% endif %}{% endfor %}"
     xcon_p2p: "--p2p {% for p2p in xcon.p2p %}{{  p2p.a_device }}/{{ p2p.a_port }}--{{ p2p.b_device }}/{{ p2p.b_port }}{% if not loop.last %} {% endif %}{% endfor %}"
   run_once: true

# Need to work on getting links as a list using xcon_links
 - name: run xconnect containers
   docker_container:
     name: "bridge"
     image: vr-xcon
     command: "{{ xcon_p2p }}"
     links:
      - wanagg1-dc1
      - wanagg2-dc1
      - wanagg1-dc2
      - wanagg2-dc2
      - wanedge1-remote1
      - wanedge2-remote1
      - infra1-remote1
      - infra2-remote1
   run_once: true
